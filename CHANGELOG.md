# ๐ ุณุฌู ุงูุชุบููุฑุงุช (Changelog)

ุฌููุน ุงูุชุบููุฑุงุช ุงููููุฉ ูู ูุฐุง ุงููุดุฑูุน ูุชู ุชูุซูููุง ูู ูุฐุง ุงูููู.

ุงูุชูุณูู ุงููุณุชูุฏ ูู [Keep a Changelog](https://keepachangelog.com/en/1.0.0/)
ููุดูู ูุฐุง ุงููุดุฑูุน: `Semantic Versioning` (vMAJOR.MINOR.PATCH).

---

## [2.0.0] - 2025-01-16

### ๐ ุฅุตุฏุงุฑ ุฑุฆูุณู ุฌุฏูุฏ - ุฅุนุงุฏุฉ ููููุฉ ูุงููุฉ (Major Refactor)

ูุฐุง ุงูุฅุตุฏุงุฑ ููุซู ูููุฉ ููุนูุฉ ูุงููุฉ ูู ุงูุจููุฉ ุงููุนูุงุฑูุฉ ูููุดุฑูุนุ ุชุญูููู ูู ููู ูุงุญุฏ monolithic ุฅูู ุจููุฉ ูุนูุงุฑูุฉ modular ูุน ุชุญุณููุงุช ูุจูุฑุฉ ูู ุงูุฃุฏุงุก ูุงูููุซูููุฉ.

---

### โจ ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ (Added)

#### ๐๏ธ **ุจููุฉ ูุนูุงุฑูุฉ ูุนูุงุฑูุฉ ูุงููุฉ (Modular Architecture)**
- ุชุญููู ุงููุดุฑูุน ูู ููู ูุงุญุฏ (~2500 ุณุทุฑ) ุฅูู 16 ููู ูููุตู
- ูุตู ุงููุฎุงูู: database, API, handlers, scheduling, logging, ุฅูุฎ
- ุณูููุฉ ุงูุตูุงูุฉ ูุงูุชุทููุฑ ุงููุณุชูุจูู

#### โฐ **ูุธุงู ุฌุฏููุฉ ูุชุทูุฑ (APScheduler)**
- ุงุณุชุจุฏุงู polling loops ุจู APScheduler Event-Driven
- ุฌุฏููุฉ ุฏูููุฉ ุฅูู ุงูุซุงููุฉ ุจุฏูุงู ูู ุฏูุงุฆู
- CronTrigger ููุนูููุงุช ุงูููููุฉ
- DateTrigger ููููุงู ุงููุญุฏุฏุฉ
- ุชูููู ุงุณุชููุงู CPU ุจุดูู ูุจูุฑ (ูู polling ูู 30 ุซุงููุฉ ุฅูู event-driven)

#### ๐ง **ูุญุฑู ุฃุญุงุฏูุซ ุฐูู (Smart Hadith Engine v2)**
- ุงุฎุชูุงุฑ ูุฆุงุช ุงูุฃุญุงุฏูุซ ุญุณุจ ุงูููุช (ุตุจุงุญุ ุธูุฑุ ุนุตุฑุ ูุณุงุกุ ููู)
- 493 ุชุตููู ุญุฏูุซ ูู API ุจุฏูุงู ูู JSON ูุญูู
- ูููุงุช ููุชุงุญูุฉ ูุชูุฏูุฉ ูููุทุงุจูุฉ
- ูุธุงู ุชุจุฑูุฏ (cooldown) ูููุน ุงูุชูุฑุงุฑ
- ุญุฏ ูููู (5 ุฃุญุงุฏูุซ ูุญุฏ ุฃูุตู)
- ุชุฎุฒูู ูุคูุช ุฐูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ๐ **ูุงุนุฏุฉ ุจูุงูุงุช ุงูุฃุญุงุฏูุซ ุงููุญุณูุฉ**
- ุฌุฏูู `categories_index` ูุชุฎุฒูู 493 ุชุตููู
- ุฌุฏูู `hadith_cache` ููุชุฎุฒูู ุงููุคูุช
- ุฌุฏูู `hadith_send_log` ูุชุชุจุน ุงูุฅุฑุณุงู (ุจุฏูุงู ูู ูุฑุงุกุฉ ููู log!)
- ููุงุฑุณ ูุญุณูุฉ ููุฃุฏุงุก

#### ๐ก๏ธ **ุชุญุณููุงุช ุงูุฃูุงู ูุงูููุซูููุฉ**
- **Thread-local connection pooling** (ุงุชุตุงู ูุงุญุฏ ููู ุฎูุท)
- **WAL mode** ูููุฑุงุกุฉ ูุงููุชุงุจุฉ ุงููุชุฒุงููุฉ
- **Context managers** ูุถูุงู ุฅุบูุงู ุงูุงุชุตุงูุงุช
- **Automatic transaction handling** (auto-commit/rollback)

#### ๐ **ูุธุงู ุชุณุฌูู ุงุญุชุฑุงูู (Professional Logging)**
- ููู ูููุตู `logger_config.py`
- **RotatingFileHandler** (10MB ูููุ 5 ูุณุฎ ุงุญุชูุงุทูุฉ)
- ููุชุฑ ูุฎุตุต ูููููุณูู (INFO+ ูู devุ ERROR+ ูู prod)
- ูุณุชูู ููุตู ูู ุงููููุ ุจุณูุท ูู ุงูุชูุฑููู
- ุฏุนู ุจูุฆุงุช ูุชุนุฏุฏุฉ (development/production)

#### โ๏ธ **ุชูููู ูุฑูุฒู ูุญุณู**
- ููู `config.py` ูููุตู
- ุฏูุงู ุชุญูู ูู ุงูุฅุนุฏุงุฏุงุช (`validate_config()`)
- ุซูุงุจุช API ูุญุฏุซุฉ (Aladhan, HadeethEnc)
- ุฅุนุฏุงุฏุงุช retry (exponential backoff)
- 18 ูุฏููุฉ ูุฏุนููุฉ ูู ุฅุนุฏุงุฏุงุช ูููุตูุฉ
- 15 ุทุฑููุฉ ุญุณุงุจ ุตูุงุฉ ูุน descriptions

#### ๐ **ุชูุงูู API ูุญุณู**
- ููู `prayer_api.py` ูููุตู
- **Retry logic ูุน exponential backoff**
- ูุนุงูุฌุฉ ุฃุฎุทุงุก ุงูุดุจูุฉ ุงููุชูุฏูุฉ
- **get_current_prayer** ูุน ูุนุงูุฌุฉ ุงูุญุงูุงุช ุงูุญุงูุฉ (midnight boundary)
- ุชุญุฏูุฏ "ุงูููู" ุญุณุจ ุชูููุช ูู ูุฌููุนุฉ

#### ๐ข **ุฎุฏูุฉ ุฅุดุนุงุฑุงุช ูููุตูุฉ**
- ููู `notification_service.py` ูููุตู
- ูุนุงูุฌุฉ ุฐููุฉ ูุฃุฎุทุงุก ุชูููุฌุฑ (403 = bot kicked)
- ุญุฐู ุชููุงุฆู ูููุฌููุนุงุช ุงูุชู ุชู ูููุง ุทุฑุฏ ุงูุจูุช
- ุฅุนุงุฏุฉ ูุญุงููุฉ ูุฅุฑุณุงู ุงูุฑุณุงุฆู

#### ๐ง **ุฃุฏูุงุช ูุณุงุนุฏุฉ ูุญุณูุฉ**
- ููู `utils.py` ูููุตู
- ุฏุงูุฉ `send_message_safe` ูุน retry mechanism
- ุฏุงูุฉ `is_user_admin` ููุชุญูู ูู ุตูุงุญูุงุช ุงููุดุฑู
- ุฏุงูุฉ `parse_time` ูุชุญููู ุงูููุช
- ุฏุงูุฉ `time_within_window` ููุชุญูู ูู ุงููุงูุฐุฉ ุงูุฒูููุฉ

#### ๐ฅ **Migration Scripts**
- ููู `update_database.py` ูุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ููู `init_categories.py` ูุชุญููู 493 ุชุตููู
- ููู `fix_columns.py` ูุฅุตูุงุญ ุงูุฃุนูุฏุฉ
- ููู `fix_tables.py` ูุฅุตูุงุญ ุงูุฌุฏุงูู

---

### ๐ ุงูุชุบููุฑุงุช (Changed)

#### **ูุงุนุฏุฉ ุงูุจูุงูุงุช (Database)**
- โ ุฅุถุงูุฉ ุฌุฏุงูู ุฌุฏูุฏุฉ:
  - `categories_index` (493 ุชุตููู)
  - `category_stats` (ุฅุญุตุงุฆูุงุช ุงูุชุญููู ุงููุณุจู)
  - `hadith_cache` (ุงูุชุฎุฒูู ุงููุคูุช ููุฃุญุงุฏูุซ)
  - `hadith_send_log` (ุณุฌู ุงูุฅุฑุณุงู - ุฅุตูุงุญ ุญุฑุฌ!)
  - `content_sent_log` (ุณุฌู ุงููุญุชูู ุงููุฑุณู)
- โ ุชูููู WAL mode (`PRAGMA journal_mode=WAL`)
- โ ุชูููู cache size ูู 10MB ุฅูู 5MB
- โ ุฅุถุงูุฉ ููุงุฑุณ ููุฃุฏุงุก:
  - `idx_hadith_cache_category`
  - `idx_hadith_cache_usage`
  - `idx_hadith_send_log_group_time`
  - `idx_categories_index_active`
  - `idx_category_stats_prefetch`

#### **ูุธุงู ุงูุฃุญุงุฏูุซ (Hadith System)**
- โ ุงุณุชุจุฏุงู ูุฑุงุกุฉ ููู log ุจุงุณุชุฎุฏุงู database queries (ุฅุตูุงุญ ุฃููู ุญุฑุฌ!)
- โ ุชูููู in-memory cache ูู 5 ุฅูู 2 ููู ุชุตููู
- โ ุฅุถุงูุฉ `fallback` ูุญูู ุนูุฏ ูุดู ุงูู API
- โ ุชุญุฏูุซ hadith_cache (usage_count, last_used_at)
- โ ุฅุถุงูุฉ hadith_send_log ูุชุชุจุน ุงูุฅุฑุณุงู

#### **ุงูุฌุฏููุฉ (Scheduling)**
- โ ุงุณุชุจุฏุงู polling loops ุจู APScheduler
- โ ุฅุฒุงูุฉ prefetch_service (ุงุณุชุจุฏุงู ุจู lazy caching)
- โ ุฅุถุงูุฉ daily reschedule job (ูู ููุชุตู ุงูููู UTC)
- โ ุฅุถุงูุฉ `reschedule_group` ููุชุญุฏูุซ ุงูููุฑู ุนูุฏ ุชุบููุฑ ุงูุฅุนุฏุงุฏุงุช

#### **ุงูุฅุนุฏุงุฏุงุช (Configuration)**
- โ ุฅุถุงูุฉ `API_MAX_RETRIES`ุ `API_RETRY_DELAY`ุ `API_RETRY_BACKOFF`
- โ ุฅุถุงูุฉ `HADITH_COOLDOWN_MINUTES`ุ `MAX_HADITH_PER_DAY`
- โ ุฅุถุงูุฉ `HADITH_WINDOWS` (4 ููุงูุฐ ุฒูููุฉ)
- โ ุฅุถุงูุฉ `DB_CACHE_SIZE`ุ `DB_SYNCHRONOUS`

#### **ุงูุชุณุฌูู (Logging)**
- โ ุฅุถุงูุฉ `LOG_FILE`ุ `LOG_MAX_BYTES`ุ `LOG_BACKUP_COUNT`
- โ ุฅุถุงูุฉ `LOG_FORMAT_DETAILED`ุ `LOG_FORMAT_SIMPLE`
- โ ุฅุถุงูุฉ `ConsoleFilter` class ูุชูููู ุงูุถูุถุงุก
- โ ุฅุถุงูุฉ `ENV` variable (development/production)

---

### ๐ ุงูุฅุตูุงุญุงุช (Fixed)

#### **ุฅุตูุงุญ ุญุฑุฌ: ูุฑุงุกุฉ ููู log ูู hadith tracking**
- โ **ุงููุดููุฉ ูู v1.0.2:**
  - ุงููุธุงู ูุงู ููุฑุฃ ููู log `hadith_brain_v2.log` ูุชุชุจุน ุงูุฃุญุงุฏูุซ ุงููุฑุณูุฉ
  - ูุฑุงุกุฉ ุงููููุงุช ุบูุฑ ุขููุฉ ูู ุจูุฆุฉ multi-threaded
  - ุงุญุชูุงู ุชุถุงุฑุจ ุงูุจูุงูุงุช ูุงูุจูุงูุงุช ุงูููููุฏุฉ
  - ุงุณุชููุงู I/O ุฒุงุฆุฏ

- โ **ุงูุญู ูู v2.0.0:**
  - ุฅุถุงูุฉ ุฌุฏูู `hadith_send_log` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  - ุชุฎุฒูู ูู hadith ูุฑุณู ูุน timestamp
  - ุงุณุชุฎุฏุงู database queries ุจุฏูุงู ูู ูุฑุงุกุฉ ุงูููู
  - ุขูู ูููุซูู ูู ุจูุฆุฉ multi-threaded
  - ุฃุฏุงุก ุฃูุถู ุจูุซูุฑ

#### **ุฅุตูุงุญ: database connection leaks**
- โ **ุงููุดููุฉ ูู v1.0.2:**
  - ุงูุงุชุตุงูุงุช ูุงูุช ุชููุชุญ ูุชูุบูู ูุฏููุงู
  - ุงุญุชูุงู ูุณูุงู ุฅุบูุงู ุงูุงุชุตุงู
  - connection leaks ุจูุฑูุฑ ุงูููุช

- โ **ุงูุญู ูู v2.0.0:**
  - Thread-local connection pooling
  - Context managers (`with get_db_connection() as conn:`)
  - Auto-commit ุนูู ุงููุฌุงุญ
  - Auto-rollback ุนูู ุงููุดู
  - ูุง connection leaks ุฃุจุฏุงู

#### **ุฅุตูุงุญ: CPU usage ูู polling loops**
- โ **ุงููุดููุฉ ูู v1.0.2:**
  - `azan_scheduler_loop` ูุงู ููููุฐ ูู 30 ุซุงููุฉ
  - `content_scheduler_loop` ูุงู ููููุฐ ูู 30 ุซุงููุฉ
  - ุงุณุชููุงู CPU ูุณุชูุฑ ุญุชู ุจุฏูู ูุดุงุท

- โ **ุงูุญู ูู v2.0.0:**
  - APScheduler event-driven
  - Jobs ุชูุฌุฏูู ูุฑุฉ ูุงุญุฏุฉ ูู ุงูููู
  - ุชูููู ุงุณุชููุงู CPU ุจุดูู ูุจูุฑ
  - ุงุณุชููุงู ุทุงูุฉ ุฃูู

#### **ุฅุตูุงุญ: timezone handling**
- โ **ุงููุดููุฉ ูู v1.0.2:**
  - "ุงูููู" ูุงู ููุญุณุจ ูุฑุฉ ูุงุญุฏุฉ ููู ุงููุฌููุนุงุช
  - ุงุญุชูุงู ุฎุทุฃ ูู ุงูุชูุงุฑูุฎ ูููุฌููุนุงุช ุจุชูููุช ูุฎุชููุฉ

- โ **ุงูุญู ูู v2.0.0:**
  - ุญุณุงุจ "ุงูููู" ููู ูุฌููุนุฉ ุญุณุจ ุชูููุชูุง
  - ุงุณุชุฎุฏุงู `datetime.now(group_tz)` ููุชุญุฏูุฏ ุงูุฏููู
  - ุชูููู ุฃุฎุทุงุก ุงูุชุงุฑูุฎ

#### **ุฅุตูุงุญ: Telegram API error handling**
- โ **ุงููุดููุฉ ูู v1.0.2:**
  - ูู ููู ููุงู ูุนุงูุฌุฉ ูู 403 (bot kicked)
  - ูุญุงููุฉ ุฅุฑุณุงู ูุณุชูุฑุฉ ููุฌููุนุงุช ุชู ูููุง ุทุฑุฏ ุงูุจูุช

- โ **ุงูุญู ูู v2.0.0:**
  - ูุนุงูุฌุฉ ุฐููุฉ ูุฃุฎุทุงุก Telegram API
  - ุญุฐู ุชููุงุฆู ูููุฌููุนุงุช ุงููุทุฑูุฏุฉ
  - ุชูููู ุงูุฃุฎุทุงุก ูู logs

---

### โก ุงูุชุญุณููุงุช (Performance)

#### **ุชุญุณููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช**
- โ WAL mode ูููุฑุงุกุฉ ูุงููุชุงุจุฉ ุงููุชุฒุงููุฉ
- โ Thread-local connection pooling
- โ ุชูููู cache size ูู 10MB ุฅูู 5MB
- โ ููุฑุณ ูุญุณูู ูุฌููุน ุงูุงุณุชุนูุงูุงุช ุงูุญุฑุฌุฉ

#### **ุชุญุณููุงุช ุงูุฐุงูุฑุฉ (Memory)**
- โ ุชูููู in-memory hadith cache ูู 5 ุฅูู 2 ููู ุชุตููู
- โ ุฅุฒุงูุฉ prefetch_service (ูู ููู ูุณุชุฎุฏูุงู)
- โ ุงุณุชุฎุฏุงู database cache ุจุฏูุงู ูู in-memory

#### **ุชุญุณููุงุช I/O**
- โ Automatic log rotation (10MB ููู)
- โ Production logging mode (WARNING+ ููุท)
- โ ุชูููู logging ูู loops

#### **ุชุญุณููุงุช Network**
- โ Exponential backoff ูุฅุนุงุฏุฉ ุงููุญุงููุฉ
- โ Cache TTL (24 ุณุงุนุฉ)
- โ Cooldown tracking (ููุน ุงูุทูุจุงุช ุงููุชูุฑุฑุฉ)

---

### โ๏ธ ุฅุฒุงูุฉ ุงููุญุชูู (Removed)

#### **Prefetch Service**
- โ ุฅุฒุงูุฉ `prefetch_service` (ุงุณุชุจุฏุงู ุจู lazy caching)
- ุงูุณุจุจ: ูู ููู ูุณุชุฎุฏูุงู ุจูุนุงููุฉุ ุงุณุชููุงู ุฒุงุฆุฏ ููููุงุฑุฏ

#### **Polling Loops**
- โ ุฅุฒุงูุฉ `azan_scheduler_loop` (ุงุณุชุจุฏุงู ุจู APScheduler)
- โ ุฅุฒุงูุฉ `content_scheduler_loop` (ุงุณุชุจุฏุงู ุจู APScheduler)
- ุงูุณุจุจ: ุงุณุชููุงู CPU ูุณุชูุฑุ ุบูุฑ ุฏููู

#### **Local JSON Content**
- โ ุฅุฒุงูุฉ ุงูุงุนุชูุงุฏ ุนูู `content.json`
- ุงูุณุจุจ: ุงุณุชุจุฏุงู ุจู API ูุน 493 ุชุตููู

---

### ๐ ุฅุตูุงุญุงุช ุฃูููุฉ (Security)

#### **Database Thread Safety**
- โ Thread-local connection pooling
- โ Context managers ูููุนุงููุงุช
- โ WAL mode ูููุฑุงุกุฉ/ุงููุชุงุจุฉ ุงููุชุฒุงููุฉ

#### **Input Validation**
- โ `validate_config()` ููุชุญูู ูู ุงูุฅุนุฏุงุฏุงุช
- โ ุชุญูู ูู BOT_TOKEN length
- โ ุชุญูู ูู API URLs (HTTPS ููุท)

---

### ๐ ุงููุซุงุฆู (Documentation)

#### **README.md**
- โ ุฅุนุงุฏุฉ ูุชุงุจุฉ ูุงููุฉ
- โ ูุณู "ููุงุฐุง ูุฐุง ุงูุจูุชุ"
- โ Architecture Diagram
- โ Data Flow Diagram
- โ Detailed Installation Guide
- โ Usage Examples
- โ Troubleshooting Section
- โ Performance Tips
- โ Migration Guide (v1.0.2 โ v2.0.0)

#### **Changelog**
- โ ุฅูุดุงุก ููู CHANGELOG.md ุดุงูู
- โ ุชูุซูู ุฌููุน ุงูุชุบููุฑุงุช ูู v1.0.2 โ v2.0.0
- โ ุชูุณูู Keep a Changelog

---

### ๐งช ุงูุงุฎุชุจุงุฑ (Testing)

#### **Migration Scripts**
- โ ุงุฎุชุจุงุฑ `update_database.py` ุนูู ูุงุนุฏุฉ ุจูุงูุงุช v1.0.2
- โ ุงุฎุชุจุงุฑ `init_categories.py` ูุน 493 ุชุตููู
- โ ุงุฎุชุจุงุฑ `fix_columns.py` ู `fix_tables.py`

#### **Core Functionality**
- โ ุงุฎุชุจุงุฑ APScheduler ุจุฏูุงู ูู polling
- โ ุงุฎุชุจุงุฑ hadith tracking ูู database
- โ ุงุฎุชุจุงุฑ WAL mode ูุน multi-threading

---

## [1.0.2] 

### โจ ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ (Added)
- ุฅุถุงูุฉ ูุธุงู logging ูุญุณูู
- ุฅุถุงูุฉ ConsoleFilter ูุชูููู ุงูุถูุถุงุก ูู ุงูุชูุฑููู
- ุฅุถุงูุฉ RotatingFileHandler ูููุน ุงูุชูุงุก ุงููุฑุต

### ๐ ุงูุฅุตูุงุญุงุช (Fixed)
- ุฅุตูุงุญ logging configuration
- ุฅุตูุงุญ timezone handling ูููุฌููุนุงุช
- ุฅุตูุงุญ prayer time parsing

---

## [1.0.1] - 

### โจ ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ (Added)
- ุฅุถุงูุฉ basic prayer times
- ุฅุถุงูุฉ azan notifications
- ุฅุถุงูุฉ prayer logging system

---

## [1.0.0] - 

### โจ ุงูุฅุตุฏุงุฑ ุงูุฃููู (Initial Release)
- ุจูุช ุฃุณุงุณู ูุฃููุงุช ุงูุตูุงุฉ
- ุฏุนู ุงููุฏู ุงูุนุฑุจูุฉ ุงูุฑุฆูุณูุฉ
- ุฅุนุฏุงุฏ ุงููุฌููุนุงุช ุงูุฃุณุงุณู

---

## ๐ ุงูุฎุทุฉ ุงููุณุชูุจููุฉ (Roadmap)

### [2.1.0] - ูุฎุทุท
- [ ] ุฏุนู ูุชุนุฏุฏ ุงููุบุงุช (English, Urdu, Turkish)
- [ ] Dashboard ููุจ ููุฅุญุตุงุฆูุงุช
- [ ] Backup/Restore automation
- [ ] Metrics & Analytics integration

### [2.2.0] - ูุฎุทุท
- [ ] Machine Learning for hadith selection
- [ ] User preferences system
- [ ] Custom prayer reminders
- [ ] Advanced analytics dashboard

### [3.0.0] - ูุฎุทุท
- [ ] Microservices architecture
- [ ] Redis cache layer
- [ ] PostgreSQL support
- [ ] REST API for external integrations

---

## ๐ ุงูุฏุนู (Support)

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
- ๐ GitHub Issues: [Report a bug](https://github.com/muslim-kh09/Islamic-Prayer-Times-Bot/issues)

---

<div align="center">

**ุชู ุชุทููุฑู ุจู โค๏ธ ูููุฌุชูุน ุงูุฅุณูุงูู**

</div>
